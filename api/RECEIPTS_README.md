# Receipts API Implementation

## Overview
This implements a complete receipts management system with validation for AWB (Air Waybill) numbers based on business rules.

## Files Modified/Created

### Backend (`api/`)
- **`app/routers/receipts.py`** - New router with full CRUD operations
- **`app/main.py`** - Updated to include receipts router
- **`RECEIPTS_API.md`** - API documentation with examples
- **`create_sample_receipts.py`** - Script to populate test data

### Router Registration
The receipts router is registered in `main.py` without a prefix, so endpoints are available at:
- `POST /receipts`
- `GET /receipts`
- `GET /receipts/{receipt_id}`
- `DELETE /receipts/{receipt_id}`
- `GET /receipts/stats/summary`

## Data Model

### ReceiptCreate (Input)
```python
{
    "receiver_name": str,           # Required
    "contact_number": str,          # Required  
    "date": str,                    # Required
    "branch": str,                  # Required
    "company": str,                 # Required
    "count_of_boxes": int,          # Required, >= 1
    "receiving_mode": str,          # Required, "Person" or "Courier"
    "forward_to_chennai": bool,     # Default: False
    "awb_no": str                   # Optional, conditionally required
}
```

### Frontend Field Mapping
The frontend sends camelCase fields which are mapped via Pydantic aliases:
- `receiverName` → `receiver_name`
- `contactNumber` → `contact_number`
- `countOfBoxes` → `count_of_boxes`
- `receivingMode` → `receiving_mode`
- `forwardToChennai` → `forward_to_chennai`
- `awbNo` → `awb_no`

### ReceiptResponse (Output)
Same fields as input plus:
```python
{
    "id": str,                      # UUID generated by backend
    "created_at": datetime          # Timestamp when created
}
```

## Validation Rules

### Business Logic Validation
AWB number (`awb_no`) is **required** when:
1. `receiving_mode = "Courier"` **OR**
2. `branch != "Chennai"` **AND** `forward_to_chennai = True`

### Field Validation
- All fields except `awb_no` are required
- `count_of_boxes` must be >= 1
- `receiving_mode` must be exactly "Person" or "Courier"
- String fields have minimum length of 1

## Storage
Currently uses in-memory list (`receipts_storage`) for simplicity. This can be easily replaced with database integration later.

## Error Handling
- **400 Bad Request**: Business rule violations (missing AWB, invalid mode, etc.)
- **422 Unprocessable Entity**: Pydantic validation errors
- **404 Not Found**: Receipt not found (for GET/DELETE by ID)
- **500 Internal Server Error**: Unexpected server errors

## Testing
Use the provided `create_sample_receipts.py` script to populate test data:

```bash
# Start the FastAPI server first
cd api
uvicorn app.main:app --reload

# In another terminal, run the test script
python create_sample_receipts.py
```

## Integration with Frontend
The receipts router is fully compatible with the existing frontend:
- Form submission sends POST to `/receipts`
- Receipts list fetches from GET `/receipts`
- All field names are mapped correctly via aliases
- Error responses are handled appropriately

## Future Enhancements
1. Database integration (replace in-memory storage)
2. Authentication/authorization
3. Pagination for large receipt lists
4. Advanced filtering and search
5. Receipt status tracking
6. File uploads (receipt images, documents)
7. Email notifications
8. Audit logging
